# Template file for 'nordvpn-bin'
pkgname=nordvpn-bin
version=4.1.1
revision=1
archs="x86_64 aarch64"
build_style=fetch
short_desc="NordVPN CLI tool for Linux"
makedepends="tar gzip sqlite"
maintainer="Orphaned <orphan@voidlinux.org>"
license="custom"
homepage="https://nordvpn.com"
nopie=true
noshlibprovides=true
system_groups="nordvpn"
repository=nonfree

case "$XBPS_TARGET_MACHINE" in
	x86_64)
		_deb="nordvpn_${version//v/-}_amd64.deb"
		distfiles="https://repo.nordvpn.com/deb/nordvpn/debian/pool/main/n/nordvpn/nordvpn_${version//v/-}_amd64.deb"
		checksum=256818d15d866c0f5f274d5586219f52f5736aefc52ce77f903bb69d0deb32e6
		;;
	aarch64)
		_deb="nordvpn_${version//v/-}_arm64.deb"
		distfiles="https://repo.nordvpn.com/deb/nordvpn/debian/pool/main/n/nordvpn/nordvpn_${version//v/-}_arm64.deb"
		checksum=c139d2facf214298ed0823124c794226df994739affb736ca1f20cf23b12e4ef
		;;
esac

do_install() {

	ar p "${_deb}" data.tar.gz > data.tar.gz
	tar -C "${DESTDIR}" -xvf data.tar.gz

	vinstall "${FILESDIR}/${XBPS_TARGET_MACHINE}/libsqlite3.so" 644 usr/lib/nordvpn/ libsqlite3.so

	vbin "${DESTDIR}/usr/sbin/nordvpnd"

	install -d "${DESTDIR}/etc/ld.so.conf.d"
	echo "/usr/lib/nordvpn" > "${DESTDIR}/etc/ld.so.conf.d/nordvpn.conf"
	chmod 644 "${DESTDIR}/etc/ld.so.conf.d/nordvpn.conf"

	rm -r "${DESTDIR}/usr/sbin"
	rm -r "${DESTDIR}/usr/lib/systemd/"
	rm -r "${DESTDIR}/etc/init.d"

	vsv nordvpn
}
