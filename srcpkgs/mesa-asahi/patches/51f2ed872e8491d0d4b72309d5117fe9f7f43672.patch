From 51f2ed872e8491d0d4b72309d5117fe9f7f43672 Mon Sep 17 00:00:00 2001
From: Asahi Lina <lina@asahilina.net>
Date: Wed, 12 Jun 2024 18:28:03 +0900
Subject: [PATCH] asahi: Make asahi_clc build work on x86_64->x86 builds

Same hack used by intel_clc.

Signed-off-by: Asahi Lina <lina@asahilina.net>
Part-of: <https://gitlab.freedesktop.org/mesa/mesa/-/merge_requests/29861>
---
 src/asahi/clc/meson.build | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/src/asahi/clc/meson.build b/src/asahi/clc/meson.build
index 5db547ffde562..888f42b18358a 100644
--- a/src/asahi/clc/meson.build
+++ b/src/asahi/clc/meson.build
@@ -9,5 +9,8 @@ prog_asahi_clc = executable(
   c_args : [pre_args, no_override_init_args],
   link_args : [ld_args_build_id],
   dependencies : [idep_mesaclc, dep_llvm, dep_spirv_tools, idep_nir],
-  native : true,
+  # If we can run host binaries directly, just build asahi_clc for the host.
+  # Most commonly this happens when doing a cross compile from an x86_64 build
+  # machine to an x86 host
+  native : not meson.can_run_host_binaries(),
 )
-- 
GitLab

